<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <title>Points on a map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.7.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.7.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="map_styles.css">
  </head>
  <body>
    <div id='map'></div>
    <div class='transactionInfo toggle-off'>
        <div>
            <span id="actor"></span> <strong id="action"></strong> <span id="target"></span>
        </div>
        <div><span id="date"></span></div>
        <div><span id="message"></span></div>
    </div>
    <script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoia2FybG8yMSIsImEiOiJjazU2M292cHYwMzhmM210NTNwcjFraTg1In0.vVyJI1XcfhRToXiW_zpduQ'; 
    let map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/karlo21/ck5d5g89s038j1io3ks740z7y', 
      center: [0, 0],
      zoom: 3,
      maxZoom: 15,
      minZoom: 3
    });
    map.addControl(new mapboxgl.NavigationControl());

    //fields that will get injected into/displayed on mouseover of transaction edges (when zoom >= 6)
    let actorField = document.getElementById('actor');
    let actionField = document.getElementById('action');
    let targetField = document.getElementById('target');
    let dateField = document.getElementById('date');
    let messageField = document.getElementById('message');
    let transactionDiv = document.querySelector('.transactionInfo');

    map.on('load', () => {

        // let mapSource = map.getSource('composite');
        // let layer = map.getLayer('1m-nodes (1)');
        // let style = map.getStyle();
        // console.log(style)
        // console.log(layer)  
        // console.log(mapSource)

        map.on('click', '1m-nodes (1)', function(e) {
            if(map.getZoom() >= 7){
                let url = `https://venmo.com/${e.features[0].properties.username}`
                window.open(url, "_blank");
            }
        });

        map.on('mousemove', '1m-nodes (1)', function(e) {
            if(map.getZoom() >= 7){
                map.getCanvas().style.cursor = 'pointer';
            }
        });

        map.on('mouseleave', '1m-nodes (1)', function(e){
            if(map.getZoom() >= 7){
                map.getCanvas().style.cursor = '';
            }
        });

        map.on('mousemove', 'mod-1m', function(e) {

            if(map.getZoom() >= 6){
                let props = e.features[0].properties
                transactionDiv.classList.remove('toggle-off');
                transactionDiv.classList.add('toggle-on');
                map.getCanvas().style.cursor = 'pointer';
                actorField.textContent = props.actor_name;
                actionField.textContent = props.action;
                targetField.textContent = props.target_name;
                dateField.textContent = props.date;
                messageField.textContent = props.message;
                // console.log(e.features[0].properties)
            }
        });

        map.on('mouseleave', 'mod-1m', function(){
            transactionDiv.classList.remove('toggle-on');
            transactionDiv.classList.add('toggle-off');
            map.getCanvas().style.cursor = '';
            actorField.textContent = '';
            actionField.textContent = '';
            targetField.textContent = '';
            dateField.textContent = '';
            messageField.textContent = '';
        });
    });



    // let actorDisplay = document.getElementById('actor');
    // let actionDisplay = document.getElementById('action');
    // let targetDisplay = document.getElementById('target');
    // let dateDisplay = document.getElementById('date');
    // let messageDisplay = document.getElementById('message');

    // map.on('load', ()=>{
    //     let mapSource = map.getSource('composite');
    //     let layer = map.getLayer('1m-nodes (1)')
    //     console.log(layer)  
    //     console.log(mapSource)
    // })

    // let nodeID = null;

    // map.on('mousemove', '1m-nodes (1)', (e) => {

    // // Set variables equal to the current feature's magnitude, location, and time
    //     map.getCanvas.style().cursor = 'pointer';
    //     let quakeMagnitude = e.features[0].properties.mag;
    //     let quakeLocation = e.features[0].properties.place;
    //     let quakeDate = new Date(e.features[0].properties.time);

    //     // Check whether features exist
    //     if (e.features.length > 0) {
    //         // Display the magnitude, location, and time in the sidebar
    //         magDisplay.textContent = quakeMagnitude;
    //         locDisplay.textContent = quakeLocation;
    //         dateDisplay.textContent = quakeDate;

    //         // If quakeID for the hovered feature is not null,
    //         // use removeFeatureState to reset to the default behavior
    //         if (quakeID) {
    //             map.removeFeatureState({
    //                 source: "earthquakes",
    //                 id: quakeID
    //             });
    //         }

    //         quakeID = e.features[0].id;

    //         // When the mouse moves over the earthquakes-viz layer, update the
    //         // feature state for the feature under the mouse
    //         map.setFeatureState({
    //         source: 'earthquakes',
    //         id: quakeID,
    //         }, {
    //         hover: true
    //         });

    //     }
    // });
    

    </script>
    
  </body>
</html>